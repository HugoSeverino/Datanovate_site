<div class="content flex flex-col justify-between items-center p-4 bg-white shadow-lg rounded-lg text-center">
    <h2 class="text-2xl font-bold mb-4 text-gray-700">✍️ Dessinez un chiffre</h2>
    <div class="relative group">
        <canvas 
          id="canvas" 
          width="280" 
          height="280"
          class="w-full h-auto border-4 border-gray-300 rounded-xl shadow-md cursor-crosshair bg-white transition-all duration-300 group-hover:border-blue-200 group-hover:shadow-lg"
        ></canvas>
      </div>
    <div class="flex flex-row justify-center space-x-4 mt-4">
        <button onclick="clearCanvas()" type="button" class="px-6 py-2.5 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 hover:shadow-lg transform transition-all duration-200 active:scale-95 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            Effacer
        </button>
    </div>
    
    <div class="mt-4 p-4 bg-blue-50 rounded-lg transition-all duration-300">
        <p id="rep" class="text-xl font-bold text-blue-600 text-center">Prêt à deviner !</p>
    </div>
</div>

<script>
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    let drawing = false;
    let autoSendInterval = null;

    ctx.fillStyle = "rgba(255, 255, 255, 1)";
    ctx.fillRect(0, 0, canvas.width, canvas.height); // Fond blanc

    canvas.addEventListener("mousedown", () => {
                lastX = event.offsetX;
                lastY = event.offsetY; 
                drawing = true;
                sendDrawing();});
    canvas.addEventListener("mouseup", () => { 
                sendDrawing();
                drawing = false;});
    canvas.addEventListener("mousemove", draw);

    let lastX = 0;
    let lastY = 0;

    function draw(event) {
        if (!drawing) return;

        ctx.fillStyle = "black";  // Couleur des points
        const pointSize = 4;  // Taille des points
    
        // Si c'est le premier mouvement, on initialise les coordonnées
        if (lastX === 0 && lastY === 0) {
            lastX = event.offsetX;
            lastY = event.offsetY;
        }
    
        // Calculer les différences entre les positions pour tracer plusieurs points
        const dx = event.offsetX - lastX;
        const dy = event.offsetY - lastY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        // Nombre de points à dessiner entre lastX, lastY et la position actuelle
        const pointsCount = Math.floor(distance / 2); // Ajuster la valeur pour avoir plus ou moins de points
    
        // Dessiner plusieurs points pour créer un effet de trait
        for (let i = 0; i < pointsCount; i++) {
            const x = lastX + (dx * i) / pointsCount;
            const y = lastY + (dy * i) / pointsCount;
    
            ctx.beginPath();
            ctx.arc(x, y, pointSize, 0, Math.PI * 2);  // Dessiner un point
            ctx.fill();
        }
    
        // Mettre à jour les coordonnées pour le prochain mouvement
        lastX = event.offsetX;
        lastY = event.offsetY;
    }

    function clearCanvas() {
        ctx.fillStyle = "rgba(255, 255, 255, 1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        document.getElementById("rep").textContent = "Prêt à deviner !";
    }

    function sendDrawing() {
        let dataURL = canvas.toDataURL("image/png");

        fetch("/save_drawing", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: dataURL })
        })
        .then(response => response.json())
        .then(data => {
            // Remplacer le contenu de la div avec l'ID 'message' par le message du serveur
            document.getElementById("rep").textContent = data.rep;
            if (drawing) {
                sendDrawing();
            }
        })
        .catch(error => console.error("Erreur:", error));
    }

</script>